@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.AppConfig

@this(
        layout: Layout,
        errorSummary: components.errorSummary,
        h1: components.h1,
        p: components.p,
        link: components.link,
        inputText: components.inputText,
        button: components.button,
        result_panel: components.authorised_account_search_panel
)

@(query: String, searchedAuthorities: SearchedAuthorities, companyName: Option[String])(implicit request: Request[_], messages: Messages, appConfig: AppConfig)

@layout(pageTitle = Some(messages("cf.search.authorities.result.title", query)), helpAndSupport = false, backLink = Some(routes.CustomsFinancialsHomeController.index.url)) {

    @h1(messages("cf.search.authorities.result.title", query), classes = "govuk-heading-xl")
    @p(messages("cf.search.authorities.result.p1", searchedAuthorities.numberOfAuthorities))
    @p("cf.search.authorities.result.p2")

 <div class="govuk-panel govuk-panel--details result govuk-!-padding-bottom-5 govuk-!-padding-top-5">
  <dl class="results govuk-!-margin-top-0 govuk-!-margin-bottom-3">
   @companyName.map { name =>
    <div>
     <dt><strong>Company name</strong></dt>
     <dd>@name</dd>
    </div>

    <div>
     <dt><strong>EORI number</strong></dt>
     <dd>@query</dd>
    </div>
   </dl>
   }

  <hr class="govuk-section-break govuk-section-break--s govuk-section-break--visible">

  @{searchedAuthorities.cdsCashAccounts.map {
      cashAccount =>
          result_panel(
              "Cash account",
              cashAccount.account.accountNumber,
              cashAccount.availableAccountBalance.getOrElse(0).toString
          )}
  }
  @{searchedAuthorities.dutyDefermentAccounts.map {
      dutyDeferment =>
          result_panel(
              "Duty deferment account",
              dutyDeferment.account.accountNumber,
              dutyDeferment.balances.fold("")(_.periodAvailableAccountBalance.toString)
          )}
  }
  @{searchedAuthorities.generalGuaranteeAccounts.map {
      guarantee =>
          result_panel(
              "General guarantee account",
              guarantee.account.accountNumber,
              guarantee.availableGuaranteeBalance.getOrElse(0).toString
          )}
  }
 </div>
}