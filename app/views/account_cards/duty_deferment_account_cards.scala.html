@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import domain.{AccountStatusClosed, AccountStatusPending, AccountStatusSuspended, DefermentAccountAvailable, DutyDefermentAccount}
@import views.helpers.HtmlHelper._
@import views.helpers.Formatters
@import config.AppConfig
@import viewmodels.{FinancialsHomeModel, DutyDefermentAccountsViewModel, DutyDefermentAccountRowModel, ContentRowModel, HeaderRowModel, NonDirectDebitContent, AccountAvailableModel, FooterLinkModel, PositiveBalanceModel}
@import views.html.account_cards.duty_deferment_inaccurate_balances_message

@this(
        accountStatus: views.html.components.account_status,
        directDebitSetup: views.html.account_cards.duty_deferment_account_direct_debit_setup,
        pendingTile: views.html.account_cards.duty_deferment_account_pending,
        balances: views.html.account_cards.duty_deferment_balances,
        duty_deferment_inaccurate_balances_message: duty_deferment_inaccurate_balances_message,
        h2: components.h2,
        hiddenStatus: views.html.components.hidden_status
)

@(model: DutyDefermentAccountsViewModel)(implicit messages: Messages, appConfig: AppConfig)

@if(true) {

<section id="duty-deferment-accounts" class="govuk-!-margin-bottom-9">

        <h2 class="govuk-heading-l govuk-!-margin-bottom-1 govuk-!-margin-top-9">
            @model.titleMsg
        </h2>

        @model.inaccurateBalancesMsg

        @for(accountRow <- model.accountSectionRows) {
            <div class="custom-card duty-deferment-account govuk-!-margin-bottom-7 govuk-!-margin-top-2">
                <div class="card-main">
                    <header class="card-header">
                        <h3 class="govuk-heading-s govuk-!-margin-bottom-1" id="@accountRow.headerRow.id">
                            @accountRow.headerRow.accountHeadingMsg
                            @accountRow.headerRow.hiddenStatus
                        </h3>
                        @accountRow.headerRow.accountStatus
                    </header>

                    @accountRow.contentRow.directDebitSetupComponent.map(identity)

                    @accountRow.contentRow.nonDirectDebitContent.map { nonDDContent =>
                            nonDDContent.accountLimit.positiveBalanceValue.map { positiveBal =>
                                    <p id=s"${positiveBal.pId}" class="available-account-balance govuk-body custom-card__balance">
                                        positiveBal.cyAvailableBalancePreMsg.map { cyAvailBalPreMsg =>
                                                <span class="custom-card__balance-text">
                                                    cyAvailBalPreMsg
                                                </span>
                                        }

                                        positiveBal.cyAvailableBalanceValue.map { cyAvailBal =>
                                                <span class="custom-card__balance-amount">
                                                    cyAvailBal
                                                </span>
                                        }

                                        positiveBal.cyAvailableBalancePostMsg.map { cyAvailPostMsg =>
                                                <span class="custom-card__balance-text">
                                                    cyAvailPostMsg
                                                </span>
                                        }

                                        positiveBal.cyAvailableBalanceMsg.map { cyAvailBalMsg =>
                                                <span class="custom-card__balance-text">
                                                    cyAvailBalMsg
                                                </span>
                                        }

                                        positiveBal.availableBalanceValue.map { availBal =>
                                                <span class="custom-card__balance-amount">
                                                    availBal
                                                </span>
                                        }

                                        positiveBal.availableBalanceMsg.map { availBalMsg =>
                                                <span class="custom-card__balance-text">
                                                    availBalMsg
                                                </span>
                                        }
                                    </p>
                            }

                            @nonDDContent.accountLimit.negativeBalanceValue.map { negBal =>
                                    <p id="duty-deferment-balance" class="available-account-balance govuk-body custom-card__balance">
                                        <span class="govuk-visually-hidden">minus</span>
                                        <span class="custom-card__balance-amount custom-card__balance-amount--negative" aria-hidden="true">&minus;</span>
                                        <span class="custom-card__balance-amount custom-card__balance-amount--negative">
                                            negBal
                                        </span>
                                    </p>
                            }
                    }

                    @accountRow.contentRow.nonDirectDebitContent.map { nonDD => nonDD.balances.get }

                    <span class="card-footer__links govuk-body">
                        @accountRow.contentRow.nonDirectDebitContent.map { nonDD =>
                                nonDD.viewStatements.map { viewStat =>
                                        <a id=s"${viewStat.id}" class=s"${viewStat.classValue}" href=s"${viewStat.href}">
                                            <span aria-hidden="true">viewStat.displayValue</span>
                                            <span class="govuk-visually-hidden">viewStat.hiddenMsg</span>
                                        </a>
                                }

                                nonDD.paymentDetails.map { payment =>
                                        <a id=s"${payment.id}" class=s"${payment.classValue}" href=s"${payment.href}">
                                            <span aria-hidden="true">payment.displayValue</span>
                                            <span class="govuk-visually-hidden">payment.hiddenMsg</span>
                                        </a>
                                }

                                nonDD.topUp.map { topUp =>
                                        <a id=s"${topUp.id}" class=s"${topUp.classValue}" href=s"${topUp.href}">
                                            <span aria-hidden="true">topUp.displayValue</span>
                                            <span class="govuk-visually-hidden">topUp.hiddenMsg</span>
                                        </a>
                                }

                                nonDD.pendingAccountGuidance.get
                        }
                    </span>

                </div>
            </div>
        }
</section>
}
